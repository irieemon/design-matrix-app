/**
 * MATRIX CARD INTERACTION SYSTEM
 *
 * Professional card states with smooth animations and accessibility.
 * Optimized for performance with minimal repaints and efficient selectors.
 */

/* ===== CARD BASE STYLES ===== */
.idea-card-base {
  /* Core properties */
  position: absolute;
  background: var(--card-background);
  border: var(--card-border);
  border-radius: var(--card-radius);
  padding: var(--card-padding);

  /* Professional shadow system */
  box-shadow: var(--shadow-card);

  /* Performance optimizations */
  will-change: transform, box-shadow, filter;
  backface-visibility: hidden;
  transform-style: preserve-3d;

  /* Smooth transitions for all interactions */
  transition:
    transform var(--duration-normal) var(--ease-out),
    box-shadow var(--duration-normal) var(--ease-out),
    filter var(--duration-fast) var(--ease-out),
    opacity var(--duration-fast) var(--ease-out);

  /* Accessibility */
  cursor: pointer;
  user-select: none;

  /* Typography */
  font-family: inherit;
  line-height: var(--leading-normal);

  /* Z-index management */
  z-index: var(--z-card-base);
}

/* ===== INTERACTION STATES ===== */

/* Hover State - Professional Elevation */
.idea-card-base:hover {
  transform: translateY(-2px) scale(var(--hover-scale));
  box-shadow: var(--shadow-card-hover);
  filter: brightness(1.02) saturate(1.1);
  z-index: var(--z-card-hover);

  /* Cursor feedback */
  cursor: grab;
}

/* Focus State - Accessibility First */
.idea-card-base:focus-visible {
  outline: var(--focus-ring);
  outline-offset: var(--focus-offset);
  z-index: var(--z-card-hover);
}

/* CRITICAL FIX: Hide focus ring during drag to prevent "green box" visual artifact */
.idea-card-base.is-dragging:focus-visible,
.idea-card-base:active:focus-visible {
  outline: none;
}

/* Active/Dragging State - SIMPLIFIED BACKGROUND */
.idea-card-base:active,
.idea-card-base.is-dragging {
  transform: scale(1.0);
  box-shadow: var(--shadow-card-active);
  z-index: var(--z-card-active);
  cursor: grabbing;

  /* SINGLE background declaration to prevent cascade conflicts */
  background: #ffffff !important;

  /* Maintain full opacity during drag - no transparency */
  opacity: 1.0;

  /* CRITICAL: Enforce box-sizing to prevent dimension overflow */
  box-sizing: border-box !important;
}

/* COLLAPSED CARD DRAG PROTECTION - REDESIGN: Updated dimensions */
.idea-card-base.is-collapsed.is-dragging,
.idea-card-base.is-collapsed:active {
  /* Maintain collapsed dimensions even during drag */
  width: 100px !important;
  height: 50px !important;
  /* Background inherited from parent .is-dragging rule */
}

/* Disabled State */
.idea-card-base:disabled,
.idea-card-base.is-disabled {
  opacity: 0.6;
  cursor: not-allowed;
  filter: grayscale(0.3);

  /* Remove interactions */
  pointer-events: none;

  /* No hover effects */
  transform: none;
  box-shadow: var(--shadow-sm);
}

/* ===== PRIORITY VISUAL SYSTEM ===== */
/* REMOVED: Priority left borders were creating L-shaped corner artifacts */
/* Priority is now indicated through other visual means (status badges, etc) */
.idea-card-priority-low,
.idea-card-priority-moderate,
.idea-card-priority-high,
.idea-card-priority-strategic,
.idea-card-priority-innovation {
  border: none;
}

/* ===== CARD CONTENT HIERARCHY ===== */
.idea-card-title {
  font-size: var(--text-base);
  font-weight: var(--font-semibold);
  color: var(--color-neutral-900);
  margin-bottom: var(--space-sm);
  line-height: var(--leading-tight);
}

.idea-card-description {
  font-size: var(--text-sm);
  color: var(--color-neutral-600);
  line-height: var(--leading-relaxed);
  margin-bottom: var(--space-md);

  /* Text overflow handling */
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
}

.idea-card-metadata {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: var(--text-xs);
  color: var(--color-neutral-400);
  margin-top: auto;
}

/* ===== BADGE SYSTEM ===== */
.idea-card-badge {
  position: absolute;
  top: var(--space-sm);
  right: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--radius-full);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  text-transform: capitalize;
  backdrop-filter: var(--backdrop-blur-sm);

  /* Prevent interaction interference */
  pointer-events: none;
  z-index: 1;
}

.idea-card-badge.priority-low {
  background: var(--color-neutral-100);
  color: var(--color-neutral-700);
}

.idea-card-badge.priority-moderate {
  background: var(--color-warning-100);
  color: var(--color-warning-700);
}

.idea-card-badge.priority-high {
  background: var(--color-danger-100);
  color: var(--color-danger-700);
}

.idea-card-badge.priority-strategic {
  background: var(--color-strategic-100);
  color: var(--color-strategic-700);
}

/* ===== ACTION BUTTONS ===== */
.idea-card-actions {
  position: absolute;
  top: 8px;
  left: 8px;
  display: flex;
  gap: 4px;
  opacity: 0;
  transform: translateY(-4px);
  transition: all var(--duration-normal) var(--ease-out);
  pointer-events: none;
  z-index: 5;
}

.idea-card-base:hover .idea-card-actions,
.idea-card-base:focus-within .idea-card-actions {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

.idea-card-action-btn {
  width: 24px;
  height: 24px;
  border: none;
  border-radius: 6px;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(8px);
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);

  display: flex;
  align-items: center;
  justify-content: center;

  transition: all var(--duration-fast) var(--ease-out);
  cursor: pointer;

  /* Icon styling */
  color: var(--color-neutral-600);
}

.idea-card-action-btn:hover {
  background: var(--color-neutral-0);
  color: var(--color-neutral-900);
  transform: scale(1.1);
  box-shadow: var(--shadow-md);
}

.idea-card-action-btn.edit {
  color: var(--color-strategic-600);
}

.idea-card-action-btn.delete {
  color: var(--color-danger-600);
}

/* ===== LOCK INDICATOR ===== */
.idea-card-lock {
  position: absolute;
  top: var(--space-sm);
  right: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  backdrop-filter: var(--backdrop-blur-md);
  z-index: 2;

  /* Animation */
  animation: pulse 2s infinite;
}

.idea-card-lock.locked-by-other {
  background: rgba(239, 68, 68, 0.9); /* Red with opacity */
  color: white;
}

.idea-card-lock.locked-by-self {
  background: rgba(59, 130, 246, 0.9); /* Blue with opacity */
  color: white;
}

/* ===== COLLAPSED STATE - REDESIGN: Compact dimensions ===== */
.idea-card-base.is-collapsed {
  /* REDESIGN: Reduced dimensions for better information density */
  width: 100px;          /* Reduced from 160px (38% reduction) */
  min-height: 50px;      /* Reduced from 64px for compact display */
  max-width: 100px;      /* Prevent expansion */
  max-height: 50px;      /* Maintain compact size */
  padding: 8px;          /* Reduced padding for tighter spacing */
  /* Enhanced visual consistency */
  border-radius: 8px !important;    /* Slightly larger radius for better proportion */
  background: #ffffff !important;   /* Force white background */
  border: 1px solid #e2e8f0 !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.08) !important;  /* Slightly more prominent shadow */
}

.idea-card-base.is-collapsed .idea-card-description,
.idea-card-base.is-collapsed .idea-card-metadata {
  display: none;
}

/* NUCLEAR OVERRIDE: Maximum specificity for collapsed card dimensions */
html body .matrix-container .idea-card-base.is-collapsed,
.matrix-canvas .idea-card-base.is-collapsed,
.matrix-viewport .idea-card-base.is-collapsed {
  /* GUARANTEED DIMENSIONS: No CSS can override these */
  width: 80px !important;
  min-width: 80px !important;
  max-width: 80px !important;
  height: 60px !important;
  min-height: 60px !important;
  max-height: 60px !important;

  /* GUARANTEED BACKGROUND: Always white, never gray */
  background-color: #ffffff !important;
  background-image: none !important;

  /* Positioning and transform stability */
  transform: translate3d(0, 0, 0) !important;
  box-sizing: border-box !important;
}

/* Collapsed card hover state - minimal feedback */
.idea-card-base.is-collapsed:hover {
  /* Very subtle hover for collapsed cards */
  transform: translate3d(0, -1px, 0) !important;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;
}

.idea-card-base.is-collapsed .idea-card-title {
  font-size: var(--text-sm);
  text-align: center;
  margin-bottom: 0;

  /* Truncate text */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* ===== DRAG PREVIEW ===== */
.idea-card-drag-preview {
  /* Enhanced visual feedback */
  transform: scale(1.1) rotate(5deg);
  box-shadow: var(--shadow-2xl);
  filter: brightness(1.1) saturate(1.3);
  opacity: 0.9;

  /* Remove pointer events during drag */
  pointer-events: none;

  /* Higher z-index */
  z-index: var(--z-overlay);
}

/* ===== QUADRANT COLOR CODING ===== */
/* REMOVED: All quadrant borders were creating L-shaped corner artifacts */
/* Quadrant identification is handled through positioning and labels */
.idea-card-base[data-quadrant="quick-wins"],
.idea-card-base[data-quadrant="strategic"],
.idea-card-base[data-quadrant="reconsider"],
.idea-card-base[data-quadrant="avoid"] {
  border: none;
}

/* ===== PERFORMANCE OPTIMIZATIONS ===== */

/* Reduce paint operations during animations */
.idea-card-base * {
  backface-visibility: hidden;
}

/* Optimize transform operations */
.idea-card-base {
  contain: layout style paint;
}

/* ===== RESPONSIVE ADJUSTMENTS ===== */
@media (max-width: 768px) {
  .idea-card-base {
    /* Smaller cards on mobile */
    width: 160px;
    min-height: 100px;
    padding: var(--space-md);
  }

  .idea-card-base:hover {
    /* Reduced hover effects on touch devices */
    transform: translateY(-1px) scale(1.01);
  }

  .idea-card-actions {
    /* Always visible on mobile */
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }
}

/* ===== ACCESSIBILITY ENHANCEMENTS ===== */
@media (prefers-reduced-motion: reduce) {
  .idea-card-base,
  .idea-card-actions,
  .idea-card-action-btn {
    transition: none;
  }

  .idea-card-lock {
    animation: none;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .idea-card-base {
    border-width: 2px;
    box-shadow: none;
  }

  .idea-card-base:focus-visible {
    outline-width: 3px;
  }
}

/* ===== NUCLEAR OVERRIDE: ELIMINATE ALL GREEN COLORS ===== */
/* Maximum specificity to override any green styling that might appear on cards */
.idea-card-base,
.idea-card-base *,
.idea-card-base::before,
.idea-card-base::after,
.idea-card-base *::before,
.idea-card-base *::after {
  /* Remove any green borders that might create corner brackets */
  border-color: currentColor !important;
}

/* Specifically target any success/green color variables */
.idea-card-base[data-quadrant="quick-wins"],
.idea-card-base[data-quadrant="quick-wins"] *,
.idea-card-base[data-quadrant="quick-wins"]::before,
.idea-card-base[data-quadrant="quick-wins"]::after {
  /* Override any green color variables */
  --color-success-500: var(--color-neutral-300) !important;
  --color-success-400: var(--color-neutral-300) !important;
  --color-success-600: var(--color-neutral-400) !important;
}

/* Remove any green backgrounds from card elements */
.idea-card-base *[style*="background"],
.idea-card-base *[class*="bg-green"],
.idea-card-base *[class*="bg-success"] {
  background-color: transparent !important;
}

/* Override success-flash animation that uses green */
@keyframes success-flash {
  0% { background-color: transparent; }
  50% { background-color: rgba(156, 163, 175, 0.1); } /* neutral-400 instead of green */
  100% { background-color: transparent; }
}